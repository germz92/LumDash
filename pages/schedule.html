<!-- Google Fonts Roboto -->
<link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">

<div class="schedule-page">
  <!-- Fixed top section -->
  <div class="top-controls-fixed">
    <h2 id="eventTitle">Program Schedule</h2>

    <div class="top-controls">
      <input id="newDate" type="date" style="display:none;">
      <button class="add-btn" onclick="openAddDateModal()">+ Add Date</button>
      <span id="toggleAllNotesBtn" class="show-notes-btn" onclick="toggleAllNotes()">Show All Notes</span>
      <button id="importBtn" class="import-btn" style="margin-left: 16px; background-color: #4a5568;">Import Schedule</button>
      <button id="exportBtn" class="export-btn" style="margin-left: 8px; background-color: #28a745;">Export to Excel</button>
      <input type="file" id="fileImport" accept=".csv,.xlsx,.xls" style="display: none;">
      <a href="#" id="downloadTemplateBtn" onclick="downloadImportTemplate()" style="margin-left: 8px; font-size: 14px; color: #4a5568;">Download Template</a>
      <button id="shareScheduleBtn" class="share-schedule-btn" style="background-color: #1565c0;" onclick="openShareScheduleModal()">
        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 4px;">share</span><span class="btn-label">Share</span>
      </button>
      <button id="changeRequestsBtn" class="cr-review-btn" onclick="openChangeRequestsPanel()">
        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 4px;">rate_review</span><span class="btn-label">Requests</span>
        <span id="crBadge" class="cr-badge" style="display:none;">0</span>
      </button>
      <button id="viewToggleBtn" class="view-toggle-btn desktop-only" onclick="toggleScheduleView()" style="margin-left: 16px;">
        <span class="material-symbols-outlined">view_module</span>
        <span id="viewToggleText">Card View</span>
      </button>
    </div>

    <div id="searchFilterContainer" class="top-controls">
      <select id="filterDateDropdown">
        <option value="all">All Dates</option>
        <!-- JS will populate more -->
      </select>
      <input id="searchInput" type="text" placeholder="Search..." oninput="handleSearchInput(event)">
    </div>
  </div>

  <div id="programSections" class="program-container"></div>
  <div id="scheduleTableView" class="schedule-table-view"></div>

  <!-- Share Schedule Modal -->
  <div id="shareScheduleModal" class="share-modal-overlay" style="display:none;">
    <div class="share-modal-content">
      <div class="share-modal-header">
        <h3><span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 6px;">share</span>Share Schedule with Client</h3>
        <button class="share-modal-close" onclick="closeShareScheduleModal()">&times;</button>
      </div>
      <div class="share-modal-body">
        <p style="color: #555; margin-bottom: 16px;">Generate a view-only link to share the schedule with your client. They will be able to view, search, and filter the schedule but cannot make any edits.</p>
        <div id="shareModalLoading" style="text-align:center; padding: 20px;">
          <div style="width:32px;height:32px;border:3px solid #e0e0e0;border-top:3px solid #1565c0;border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 12px;"></div>
          <span style="color:#888;">Generating link...</span>
        </div>
        <div id="shareModalResult" style="display:none;">
          <label style="font-weight:500;font-size:13px;color:#555;display:block;margin-bottom:6px;">Share Link</label>
          <div style="display:flex; gap:8px; align-items:center;">
            <input type="text" id="shareLinkInput" readonly style="flex:1; padding:10px 12px; border:1.5px solid #ccc; border-radius:8px; font-size:14px; background:#f8f9fa; color:#333;">
            <button id="copyShareLinkBtn" onclick="copyShareLink()" style="padding:10px 18px; background:#1565c0; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600; white-space:nowrap; transition: background 0.2s;">
              <span class="material-symbols-outlined" style="font-size:18px; vertical-align:middle; margin-right:4px;">content_copy</span>Copy
            </button>
          </div>
          <div id="shareCopyFeedback" style="display:none; color:#28a745; font-size:13px; margin-top:8px; font-weight:500;">
            <span class="material-symbols-outlined" style="font-size:16px; vertical-align:middle; margin-right:4px;">check_circle</span>Link copied to clipboard!
          </div>
          <div style="margin-top:20px; padding-top:16px; border-top:1px solid #eee;">
            <button id="revokeShareBtn" onclick="revokeShareLink()" style="padding:8px 16px; background:#fff; color:#dc3545; border:1.5px solid #dc3545; border-radius:8px; cursor:pointer; font-weight:500; font-size:13px; transition: all 0.2s;">
              <span class="material-symbols-outlined" style="font-size:16px; vertical-align:middle; margin-right:4px;">link_off</span>Revoke Link
            </button>
            <span style="font-size:12px; color:#888; margin-left:12px;">Disables the current share link</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Requests Review Panel -->
  <div id="crReviewModal" class="cr-review-overlay" style="display:none;">
    <div class="cr-review-panel">
      <div class="cr-review-header">
        <h3><span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 6px;">rate_review</span>Client Change Requests</h3>
        <div style="display: flex; align-items: center; gap: 8px;">
          <select id="crSectionFilter" onchange="filterChangeRequests()" style="padding:6px 10px; border:1px solid #ddd; border-radius:6px; font-size:13px;">
            <option value="all">All Sections</option>
            <option value="schedule">Schedule</option>
            <option value="shotlist">Shotlist</option>
          </select>
          <select id="crStatusFilter" onchange="filterChangeRequests()" style="padding:6px 10px; border:1px solid #ddd; border-radius:6px; font-size:13px;">
            <option value="pending">Pending</option>
            <option value="accepted">Accepted</option>
            <option value="rejected">Rejected</option>
            <option value="all">All</option>
          </select>
          <button class="share-modal-close" onclick="closeChangeRequestsPanel()">&times;</button>
        </div>
      </div>
      <div id="crShareLinkBar" style="display:none; padding: 12px 20px; border-bottom: 1px solid #eee; background: #f8f9fa;">
        <label style="font-size: 12px; font-weight: 500; color: #666; display: block; margin-bottom: 4px;">Shared Schedule Link</label>
        <div style="display: flex; gap: 6px; align-items: center;">
          <input type="text" id="crShareLinkInput" readonly style="flex:1; padding:7px 10px; border:1.5px solid #ddd; border-radius:6px; font-size:13px; background:white; color:#333;">
          <button onclick="copyCrShareLink()" style="padding:7px 14px; background:#1565c0; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600; font-size:13px; white-space:nowrap;">
            <span class="material-symbols-outlined" style="font-size:15px; vertical-align:middle; margin-right:3px;">content_copy</span>Copy
          </button>
        </div>
        <div id="crShareCopyFeedback" style="display:none; color:#28a745; font-size:12px; margin-top:4px; font-weight:500;">
          <span class="material-symbols-outlined" style="font-size:14px; vertical-align:middle;">check_circle</span> Copied!
        </div>
      </div>
      <div id="crReviewBody" class="cr-review-body">
        <div style="text-align:center; padding:40px; color:#888;">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Add Date Modal -->
  <div id="addDateModal" class="share-modal-overlay" style="display:none;">
    <div class="share-modal-content" style="max-width: 360px;">
      <div class="share-modal-header">
        <h3><span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 6px;">calendar_month</span>Add Date</h3>
        <button class="share-modal-close" onclick="closeAddDateModal()">&times;</button>
      </div>
      <div class="share-modal-body" style="padding: 20px;">
        <p style="color: #555; margin-bottom: 12px; font-size: 14px;">Select a date to add a new section to the schedule.</p>
        <input type="date" id="addDateModalInput" style="width: 100%; padding: 10px 12px; border: 1.5px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
        <div style="display: flex; justify-content: flex-end; gap: 8px; margin-top: 16px;">
          <button onclick="closeAddDateModal()" style="padding: 8px 20px; background: #f5f5f5; color: #555; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px;">Cancel</button>
          <button onclick="confirmAddDate()" style="padding: 8px 20px; background: #CC0007; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">Add Date</button>
        </div>
      </div>
    </div>
  </div>
</div>
